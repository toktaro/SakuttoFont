<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>SakuttoFont | 画像からSVG / フォントを生成</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=M+PLUS+1+Code:wght@100..700&display=swap" rel="stylesheet">
    
    <!-- 必要なライブラリを読み込み -->
    <script src="https://opentype.js.org/dist/opentype.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <style>
        /* 元の「Img -> SVG」ツールのスタイル */
        * {font-family: "M PLUS 1 Code", monospace; font-optical-sizing: auto; font-weight: 300; font-style: normal; }
        body { font-family: sans-serif; width: 800px; margin: 0 auto; padding: 20px 100px 100px; 
        background-color: #fafafa; color: #444; }
        canvas, img { border: 1px solid #ccc; max-width: 400px; max-height: 400px; margin-top: 10px; }
        .container { display: flex; gap: 20px; flex-wrap: nowrap; }
        .controls { display: flex; flex-direction: column; gap: 10px; }

        button { width: 100%; padding: 8px 16px; font-size: 14px; color: white; background-color: #007bff; border: none; border-radius: 4px; cursor: pointer; text-align: center; }
        button:hover { background-color: #0056b3; }
        button:disabled { background-color: #6c757d; cursor: not-allowed; }
        
        fieldset { border: 1px solid #ccc; border-radius: 4px; padding: 15px; margin: 20px 0 10px; }
        legend { font-weight: bold; padding: 0 5px; }
        h1 { text-align: center; font-weight: 700;}
        h3 { margin-bottom: 0px; }
        p { font-weight: 500; margin-top: 20px; margin-bottom: 5px; }

        /* フォント生成用の追加スタイル */
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #333; }
        input[type="file"],
        input[type="text"] {
            display: block;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 4px;
            width: calc(100% - 22px);
        }
        .radio-group label { display: inline-block; font-weight: normal; margin-left: 5px; margin-right: 15px; }
        .radio-group input[type="radio"] { vertical-align: middle; }
        #status {
            margin-top: 15px;
            padding: 10px;
            border-radius: 4px;
            text-align: center;
            font-weight: bold;
            display: none; /* 初期状態は非表示 */
        }
        .status-processing { display: block; background-color: #fff3cd; color: #856404; }
        .status-success { display: block; background-color: #d4edda; color: #155724; }
        .status-error { display: block; background-color: #f8d7da; color: #721c24; }
        footer {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #ccc;
            text-align: center;
            font-size: 12px;
            color: #666;
        }
        .copyright {
            margin-top: 10px;
        }
        p > a { text-decoration: none; font-weight: 500; color: #444; }
    </style>
</head>
<body>
    <h1>SakuttoFont</h1>
    <p style="font-weight: 300; font-size: 0.9em; line-height: 1.5; margin: -20px 0 30px; text-align: center;">- Image To SVG & OTF Converter -</p>
    <hr>
    <div class="controls">
        <p>1. 画像ファイルを選んでください。（複数選択可）</p>
        <p style="font-weight: 300; font-size: 0.9em; line-height: 1.5; margin-top: -5px;">ファイル名が文字として登録されます（例: `あ.png` -> `あ`）<br>
        ※macOSなど英大・小文字を区別しないOSで英大・小文字を作成する場合'a .png'のように大・小文字のどちらか一方に半角スペースを入れてください。</p>
        <input type="file" id="imageLoader" accept="image/*" multiple>
        
        <p>2. しきい値（どこまでを黒と判定するか）を調整してください。</p>
        <p style="font-weight: 300; font-size: 0.9em; line-height: 1.5; margin-top: -5px;">※黒の部分がSVGのパスに変換されます。</p>
        <label for="threshold">しきい値 (0-255): <span id="thresholdValue">128</span></label>
        <input type="range" id="threshold" min="0" max="255" value="128">

        <div class="container">
            <div>
                <h3>プレビュー｜元の画像</h3>
                <canvas id="originalCanvas"></canvas>
            </div>
            <div>
                <h3>白黒2値化後</h3>
                <canvas id="previewCanvas"></canvas>
            </div>
        </div>

        <p>3. 生成するSVGのサイズを選んでください。</p>
        <fieldset>
            <legend>SVGベクターサイズ</legend>
            <div class="radio-group">
                <input type="radio" id="sizeOriginal" name="outputSize" value="original">
                <label for="sizeOriginal">元の画像サイズ</label>
            </div>
            <div class="radio-group">
                <input type="radio" id="sizeFixedHeight" name="outputSize" value="fixedHeight" checked>
                <label for="sizeFixedHeight">高さを1000pxに固定（縦横比維持：フォント生成の場合こちらを推奨）</label>
            </div>
        </fieldset>

        <!-- ▼▼▼ 出力アクション ▼▼▼ -->
        <p>4. 出力形式を選び、「ダウンロード」ボタンを押してください。</p>
        <fieldset>
            <legend>出力アクション</legend>
            
            <!-- SVGダウンロード -->
            <button id="convertSvgBtn" disabled>SVGに変換してダウンロード</button>
            <p style="font-size: 0.8em; text-align: center; margin-top:5px;">1ファイルは.svg、複数ファイルは.zipで出力します。</p>
            
            <hr style="margin: 20px 0;">

            <!-- フォント生成 -->
            <label for="font-name-input">フォント名:</label>
            <input type="text" id="font-name-input" value="">

            <label style="margin-top:10px;">文字の幅:</label>
            <div class="radio-group">
                <input type="radio" id="width-fixed" name="width-option" value="fixed" checked>
                <label for="width-fixed">1000に固定（等幅）</label>
                <input type="radio" id="width-svg" name="width-option" value="svg">
                <label for="width-svg">SVGの幅に合わせる（プロポーショナル）</label>
            </div>
            <button id="generateFontBtn" style="margin-top:15px; background-color: #28a745;" onmouseover="this.style.backgroundColor='#218838'" onmouseout="this.style.backgroundColor='#28a745'" disabled>フォント（OTF）を生成してダウンロード</button>
            <div id="status"></div>
        </fieldset>
        <!-- ▲▲▲ 出力アクション ここまで ▲▲▲ -->
    </div>
    
    <script src="potrace_custom.js"></script>
    <script src="main.js"></script>
    <footer>
        <p>このツールは現在テスト開発中のものであり、生成するOTFは簡易的なものです。<br>うまく動作しない可能性もございますので、あらかじめご了承ください。</p>
        <p><a href="README.md">README</a> | <a href="LICENSE.md">LICENSE</a> | <a href="https://github.com/toktaro/SakuttoFont">GitHub</a></p>
        <p class="copyright">© 2025- toktaro — Licensed under GPL v2. <br>
  Includes open-source components under MIT and GPL licenses.</p>
    </footer>
</body>
</html>
